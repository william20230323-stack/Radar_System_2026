import requests, time, os
from config import RADAR_TOKEN, RADAR_CHAT_ID, SYMBOL

def send_tg(msg):
    token = str(RADAR_TOKEN).strip()
    chat_id = str(RADAR_CHAT_ID).strip()
    url = f"https://api.telegram.org/bot{token}/sendMessage"
    payload = {"chat_id": chat_id, "text": msg, "parse_mode": "Markdown"}
    try:
        r = requests.post(url, json=payload, timeout=10)
        # é€™è£¡æœƒåœ¨ GitHub æ—¥èªŒé¡¯ç¤ºç™¼é€çµæœï¼Œ200 å°±æ˜¯æˆåŠŸ
        print(f"ğŸ“¡ å‚³é€ç‹€æ…‹ç¢¼: {r.status_code}")
        if r.status_code != 200:
            print(f"âŒ éŒ¯èª¤åŸå› : {r.text}")
    except Exception as e:
        print(f"âš ï¸ ç¶²è·¯ç•°å¸¸: {e}")

def get_whale_data():
    # æŠ“å–å¹£å®‰å¤§æˆ¶æŒå€‰æ¯”ä¾‹
    url = "https://fapi.binance.com/futures/data/topLongShortAccountRatio"
    try:
        r = requests.get(url, params={"symbol": SYMBOL, "period": "5m", "limit": 1}, timeout=10)
        data = r.json()
        return float(data[0]['longAccount']) if data else None
    except: return None

if __name__ == "__main__":
    ratio = get_whale_data()
    val = f"{ratio:.2%}" if ratio else "åµæ¸¬ä¸­"
    
    # æ–°æ©Ÿå•Ÿå‹•æˆ°å ±
    msg = (f"ğŸ”¥ *ã€William_Hunter_V2ï¼šç«åŠ›å…¨é–‹ã€‘*\n"
           f"ğŸ“Š æ¨™çš„ï¼š`{SYMBOL}`\n"
           f"ğŸ³ å¤§æˆ¶å¤šé ­ï¼š`{val}`\n"
           f"ğŸ“¡ æ­¦å™¨åº«ä¸‰é‡é˜²ç¦¦ç¶²å·²æ›è¼‰ï¼Œé–‹å§‹å·¡èˆªï¼")
    
    send_tg(msg)
    time.sleep(240) # ç¶­æŒèƒŒæ™¯é‹ä½œ 4 åˆ†é˜
